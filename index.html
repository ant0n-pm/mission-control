<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #111113;
      --bg-tertiary: #18181b;
      --bg-hover: #1f1f23;
      --bg-active: #27272a;
      --border: #27272a;
      --border-light: #3f3f46;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --accent-muted: rgba(99, 102, 241, 0.15);
      --success: #22c55e;
      --success-muted: rgba(34, 197, 94, 0.15);
      --warning: #eab308;
      --warning-muted: rgba(234, 179, 8, 0.15);
      --danger: #ef4444;
      --danger-muted: rgba(239, 68, 68, 0.15);
      --purple: #a855f7;
      --purple-muted: rgba(168, 85, 247, 0.15);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Snappier transitions */
    .transition { transition: all 0.1s ease; }
    .transition-colors { transition: color 0.1s, background-color 0.1s, border-color 0.1s; }
    
    /* Layout */
    .app {
      display: flex;
      height: 100vh;
    }
    
    /* Sidebar Nav */
    .sidebar {
      width: 240px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    
    .logo {
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      font-size: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .nav {
      flex: 1;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    
    .nav-section {
      margin-top: 16px;
      margin-bottom: 8px;
      padding: 0 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 14px;
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.1s;
    }
    
    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    
    .nav-item.active {
      background: var(--accent-muted);
      color: var(--accent-hover);
    }
    
    .nav-item .icon {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }
    
    .nav-item .badge {
      margin-left: auto;
      background: var(--danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
    }
    
    /* Anton Status in Sidebar */
    .sidebar-status {
      padding: 16px;
      border-top: 1px solid var(--border);
      background: var(--bg-tertiary);
    }
    
    .status-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .status-info {
      flex: 1;
    }
    
    .status-name {
      font-weight: 600;
      font-size: 13px;
    }
    
    .status-state {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .status-dot.working { background: var(--accent); animation: pulse 1.5s infinite; }
    .status-dot.idle { background: var(--warning); }
    .status-dot.offline { background: var(--text-muted); }
    
    .status-details {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    
    .status-task {
      background: var(--bg-hover);
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 10px;
    }
    
    .status-task-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    
    .status-task-text {
      font-size: 12px;
      color: var(--text-primary);
      line-height: 1.4;
    }
    
    .status-tokens {
      margin-bottom: 8px;
    }
    
    .token-bar {
      height: 4px;
      background: var(--bg-hover);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 6px;
    }
    
    .token-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    .token-stats {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    
    .token-io {
      display: flex;
      gap: 12px;
      font-size: 11px;
      color: var(--text-secondary);
    }
    
    .token-io span:first-child { color: var(--success); }
    .token-io span:last-child { color: var(--accent); }
    
    .status-updated {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 8px;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(0.95); }
    }
    
    /* Main Content */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-secondary);
    }
    
    .header-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    .content {
      flex: 1;
      overflow: auto;
      padding: 24px;
    }
    
    /* Buttons */
    .btn {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.1s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn-primary {
      background: var(--accent);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    
    .btn-secondary:hover {
      background: var(--bg-hover);
      border-color: var(--border-light);
    }
    
    .btn-success {
      background: var(--success-muted);
      color: var(--success);
    }
    
    .btn-success:hover {
      background: rgba(34, 197, 94, 0.25);
    }
    
    .btn-danger {
      background: var(--danger-muted);
      color: var(--danger);
    }
    
    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.25);
    }
    
    .btn-sm {
      padding: 6px 10px;
      font-size: 12px;
    }
    
    /* Page: Dashboard */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }
    
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .stat {
      text-align: center;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .activity-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      font-size: 13px;
    }
    
    .activity-icon {
      font-size: 16px;
    }
    
    .activity-text {
      flex: 1;
      color: var(--text-secondary);
    }
    
    .activity-time {
      color: var(--text-muted);
      font-size: 12px;
    }
    
    /* Page: Projects */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }
    
    .project-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.1s;
    }
    
    .project-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }
    
    .project-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .project-icon {
      width: 40px;
      height: 40px;
      background: var(--accent-muted);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .project-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }
    
    .project-status.active { background: var(--success-muted); color: var(--success); }
    .project-status.planning { background: var(--warning-muted); color: var(--warning); }
    .project-status.idea { background: var(--purple-muted); color: var(--purple); }
    .project-status.paused { background: var(--bg-tertiary); color: var(--text-muted); }
    
    .project-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .project-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.5;
    }
    
    .project-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .project-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Page: Kanban */
    .kanban {
      display: flex;
      gap: 16px;
      height: 100%;
      min-width: max-content;
      padding-bottom: 20px;
    }
    
    .kanban-column {
      width: 300px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      border-radius: 10px;
      border: 1px solid var(--border);
      max-height: calc(100vh - 160px);
    }
    
    .column-header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .column-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .column-count {
      background: var(--bg-tertiary);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      color: var(--text-secondary);
    }
    
    .column-add {
      width: 24px;
      height: 24px;
      border-radius: 5px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: all 0.1s;
    }
    
    .column-add:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    
    .column-cards {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .task-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      cursor: grab;
      transition: all 0.1s;
    }
    
    .task-card:hover {
      border-color: var(--border-light);
      transform: translateY(-1px);
    }
    
    .task-card:active {
      cursor: grabbing;
    }
    
    .task-card.dragging {
      opacity: 0.5;
    }
    
    .task-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .task-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .task-tag {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 500;
    }
    
    .tag-feature { background: var(--accent-muted); color: var(--accent-hover); }
    .tag-bug { background: var(--danger-muted); color: var(--danger); }
    .tag-idea { background: var(--purple-muted); color: var(--purple); }
    .tag-infra { background: var(--warning-muted); color: var(--warning); }
    
    /* Page: Approvals */
    .approvals-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 700px;
    }
    
    .approval-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      transition: all 0.1s;
    }
    
    .approval-card.urgent {
      border-left: 3px solid var(--warning);
    }
    
    .approval-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .approval-title {
      font-size: 15px;
      font-weight: 600;
    }
    
    .approval-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      background: var(--warning-muted);
      color: var(--warning);
    }
    
    .approval-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.6;
    }
    
    .approval-meta {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }
    
    .approval-actions {
      display: flex;
      gap: 8px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .empty-state-sub {
      font-size: 13px;
      color: var(--text-muted);
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 100;
      animation: fadeIn 0.1s ease;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      animation: slideUp 0.15s ease;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 16px;
      font-weight: 600;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      font-family: inherit;
      transition: border-color 0.1s;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    /* Page visibility */
    .page { display: none; }
    .page.active { display: block; }
    .page-kanban.active { display: flex; flex-direction: column; height: 100%; }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">üöÄ</div>
        <span>Mission Control</span>
      </div>
      
      <nav class="nav">
        <a class="nav-item active" data-page="dashboard" onclick="navigate('dashboard')">
          <span class="icon">üìä</span>
          Dashboard
        </a>
        <a class="nav-item" data-page="projects" onclick="navigate('projects')">
          <span class="icon">üìÅ</span>
          Projects
        </a>
        <a class="nav-item" data-page="tasks" onclick="navigate('tasks')">
          <span class="icon">‚úÖ</span>
          Tasks
        </a>
        <a class="nav-item" data-page="approvals" onclick="navigate('approvals')">
          <span class="icon">üîî</span>
          Approvals
          <span class="badge" id="approvalBadge" style="display: none;">0</span>
        </a>
        
        <div class="nav-section">Ideas</div>
        <a class="nav-item" data-page="ideas" onclick="navigate('ideas')">
          <span class="icon">üí°</span>
          Backlog
        </a>
      </nav>
      
      <!-- Anton Status -->
      <div class="sidebar-status">
        <div class="status-header">
          <div class="status-avatar">ü§ñ</div>
          <div class="status-info">
            <div class="status-name">Anton</div>
            <div class="status-state">
              <div class="status-dot" id="statusDot"></div>
              <span id="statusText">Connecting...</span>
            </div>
          </div>
        </div>
        <div class="status-details" id="statusDetails">
          <div class="status-task" id="statusTask" style="display: none;">
            <div class="status-task-label">Working on</div>
            <div class="status-task-text" id="statusTaskText"></div>
          </div>
          <div class="status-tokens">
            <div class="token-bar">
              <div class="token-bar-fill" id="tokenBarFill" style="width: 0%"></div>
            </div>
            <div class="token-stats">
              <span id="tokenContext">0k</span> / <span id="tokenMax">400k</span> context
            </div>
            <div class="token-io">
              <span>‚Üì <span id="tokenIn">0</span></span>
              <span>‚Üë <span id="tokenOut">0</span></span>
            </div>
          </div>
          <div class="status-updated" id="statusUpdated">Last sync: --</div>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main">
      <!-- Dashboard Page -->
      <div class="page active" id="page-dashboard">
        <div class="header">
          <h1 class="header-title">Dashboard</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openTaskModal()">+ New Task</button>
          </div>
        </div>
        <div class="content">
          <div class="dashboard-grid">
            <!-- Stats Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">üìà Overview</div>
              </div>
              <div class="card-body">
                <div class="stat-grid">
                  <div class="stat">
                    <div class="stat-value" id="stat-projects">0</div>
                    <div class="stat-label">Active Projects</div>
                  </div>
                  <div class="stat">
                    <div class="stat-value" id="stat-tasks">0</div>
                    <div class="stat-label">Tasks In Progress</div>
                  </div>
                  <div class="stat">
                    <div class="stat-value" id="stat-completed">0</div>
                    <div class="stat-label">Completed This Week</div>
                  </div>
                  <div class="stat">
                    <div class="stat-value" id="stat-approvals">0</div>
                    <div class="stat-label">Pending Approvals</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Activity Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">‚ö° Recent Activity</div>
              </div>
              <div class="card-body">
                <div class="activity-list" id="activityList">
                  <div class="empty-state">
                    <div class="empty-state-text">No activity yet</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Current Focus Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">üéØ Current Focus</div>
              </div>
              <div class="card-body" id="currentFocus">
                <div class="empty-state">
                  <div class="empty-state-text">No active tasks</div>
                  <div class="empty-state-sub">Create a task to get started</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Projects Page -->
      <div class="page" id="page-projects">
        <div class="header">
          <h1 class="header-title">Projects</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openProjectModal()">+ New Project</button>
          </div>
        </div>
        <div class="content">
          <div class="projects-grid" id="projectsGrid">
            <!-- Rendered by JS -->
          </div>
        </div>
      </div>
      
      <!-- Tasks Page (Kanban) -->
      <div class="page page-kanban" id="page-tasks">
        <div class="header">
          <h1 class="header-title">Tasks</h1>
          <div class="header-actions">
            <select class="form-select" id="taskProjectFilter" style="width: auto;" onchange="renderKanban()">
              <option value="all">All Projects</option>
            </select>
            <button class="btn btn-primary" onclick="openTaskModal()">+ New Task</button>
          </div>
        </div>
        <div class="content" style="overflow-x: auto;">
          <div class="kanban" id="kanban"></div>
        </div>
      </div>
      
      <!-- Approvals Page -->
      <div class="page" id="page-approvals">
        <div class="header">
          <h1 class="header-title">Approvals</h1>
        </div>
        <div class="content">
          <div class="approvals-list" id="approvalsList"></div>
        </div>
      </div>
      
      <!-- Ideas Page -->
      <div class="page" id="page-ideas">
        <div class="header">
          <h1 class="header-title">Ideas Backlog</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openIdeaModal()">+ New Idea</button>
          </div>
        </div>
        <div class="content">
          <div class="projects-grid" id="ideasGrid"></div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Task Modal -->
  <div class="modal-overlay" id="taskModal" onclick="closeModal('taskModal', event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">Create Task</div>
      </div>
      <form onsubmit="createTask(event)">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" id="taskTitle" required placeholder="What needs to be done?">
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="taskDesc" placeholder="Add details..."></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Project</label>
              <select class="form-select" id="taskProject">
                <option value="">No Project</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Type</label>
              <select class="form-select" id="taskType">
                <option value="feature">Feature</option>
                <option value="bug">Bug</option>
                <option value="idea">Idea</option>
                <option value="infra">Infrastructure</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Priority</label>
              <select class="form-select" id="taskPriority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Requires Approval</label>
              <select class="form-select" id="taskApproval">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Task</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Project Modal -->
  <div class="modal-overlay" id="projectModal" onclick="closeModal('projectModal', event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">Create Project</div>
      </div>
      <form onsubmit="createProject(event)">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" id="projectName" required placeholder="Project name">
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="projectDesc" placeholder="What's this project about?"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Icon (emoji)</label>
              <input type="text" class="form-input" id="projectIcon" placeholder="üöÄ" maxlength="2">
            </div>
            <div class="form-group">
              <label class="form-label">Status</label>
              <select class="form-select" id="projectStatus">
                <option value="idea">Idea</option>
                <option value="planning">Planning</option>
                <option value="active" selected>Active</option>
                <option value="paused">Paused</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Revenue Potential</label>
            <input type="text" class="form-input" id="projectRevenue" placeholder="e.g., $1k/mo, $10k one-time">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('projectModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Project</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Idea Modal -->
  <div class="modal-overlay" id="ideaModal" onclick="closeModal('ideaModal', event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">Capture Idea</div>
      </div>
      <form onsubmit="createIdea(event)">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Idea</label>
            <input type="text" class="form-input" id="ideaTitle" required placeholder="What's the idea?">
          </div>
          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea class="form-textarea" id="ideaDesc" placeholder="Any details, links, thoughts..."></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Potential</label>
            <select class="form-select" id="ideaPotential">
              <option value="low">Low - Nice to have</option>
              <option value="medium" selected>Medium - Could be good</option>
              <option value="high">High - Big opportunity</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('ideaModal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Idea</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // State Management
    const STORAGE_KEY = 'mission-control-v2';
    
    const defaultState = {
      projects: [],
      tasks: {
        backlog: [],
        todo: [],
        'in-progress': [],
        review: [],
        done: []
      },
      approvals: [],
      ideas: [],
      activity: [],
      anton: {
        status: 'online',
        currentTask: null,
        lastActivity: new Date().toISOString()
      }
    };
    
    let state = loadState();
    
    function loadState() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) return { ...defaultState, ...JSON.parse(saved) };
      } catch (e) { console.error('Load failed:', e); }
      return { ...defaultState };
    }
    
    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }
    
    function addActivity(icon, text) {
      state.activity.unshift({
        id: generateId(),
        icon,
        text,
        time: new Date().toISOString()
      });
      state.activity = state.activity.slice(0, 20);
      state.anton.lastActivity = new Date().toISOString();
    }
    
    // Navigation
    function navigate(page) {
      document.querySelectorAll('.nav-item').forEach(el => {
        el.classList.toggle('active', el.dataset.page === page);
      });
      document.querySelectorAll('.page').forEach(el => {
        el.classList.toggle('active', el.id === `page-${page}`);
      });
      render();
    }
    
    // Render
    function render() {
      renderDashboard();
      renderProjects();
      renderKanban();
      renderApprovals();
      renderIdeas();
      updateProjectSelects();
      saveState();
    }
    
    function renderDashboard() {
      const activeProjects = state.projects.filter(p => p.status === 'active').length;
      const inProgress = state.tasks['in-progress'].length;
      const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
      const completedWeek = state.tasks.done.filter(t => new Date(t.completedAt) > weekAgo).length;
      
      document.getElementById('stat-projects').textContent = activeProjects;
      document.getElementById('stat-tasks').textContent = inProgress;
      document.getElementById('stat-completed').textContent = completedWeek;
      document.getElementById('stat-approvals').textContent = state.approvals.length;
      
      // Activity
      const activityList = document.getElementById('activityList');
      if (state.activity.length === 0) {
        activityList.innerHTML = '<div class="empty-state"><div class="empty-state-text">No activity yet</div></div>';
      } else {
        activityList.innerHTML = state.activity.slice(0, 5).map(a => `
          <div class="activity-item">
            <span class="activity-icon">${a.icon}</span>
            <span class="activity-text">${escapeHtml(a.text)}</span>
            <span class="activity-time">${timeAgo(a.time)}</span>
          </div>
        `).join('');
      }
      
      // Current Focus
      const focus = document.getElementById('currentFocus');
      const current = state.tasks['in-progress'][0];
      if (current) {
        focus.innerHTML = `
          <div class="task-card" style="cursor: default;">
            <div class="task-title">${escapeHtml(current.title)}</div>
            <div class="task-meta">
              <span class="task-tag tag-${current.type}">${current.type}</span>
              ${current.projectId ? `<span>‚Ä¢ ${getProjectName(current.projectId)}</span>` : ''}
            </div>
          </div>
        `;
      } else {
        focus.innerHTML = '<div class="empty-state"><div class="empty-state-text">No active tasks</div><div class="empty-state-sub">Move a task to "In Progress" to focus</div></div>';
      }
    }
    
    function renderProjects() {
      const grid = document.getElementById('projectsGrid');
      if (state.projects.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÅ</div><div class="empty-state-text">No projects yet</div><div class="empty-state-sub">Create your first project to get started</div></div>';
        return;
      }
      grid.innerHTML = state.projects.map(p => {
        const taskCount = Object.values(state.tasks).flat().filter(t => t.projectId === p.id).length;
        return `
          <div class="project-card">
            <div class="project-header">
              <div class="project-icon">${p.icon || 'üìÅ'}</div>
              <span class="project-status ${p.status}">${p.status}</span>
            </div>
            <div class="project-name">${escapeHtml(p.name)}</div>
            <div class="project-desc">${escapeHtml(p.description || 'No description')}</div>
            <div class="project-meta">
              <span class="project-meta-item">‚úÖ ${taskCount} tasks</span>
              ${p.revenue ? `<span class="project-meta-item">üí∞ ${escapeHtml(p.revenue)}</span>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }
    
    function renderKanban() {
      const columns = [
        { id: 'backlog', title: 'Backlog' },
        { id: 'todo', title: 'To Do' },
        { id: 'in-progress', title: 'In Progress' },
        { id: 'review', title: 'Review' },
        { id: 'done', title: 'Done' }
      ];
      
      const filter = document.getElementById('taskProjectFilter')?.value || 'all';
      
      document.getElementById('kanban').innerHTML = columns.map(col => {
        let tasks = state.tasks[col.id] || [];
        if (filter !== 'all') tasks = tasks.filter(t => t.projectId === filter);
        
        return `
          <div class="kanban-column" data-column="${col.id}">
            <div class="column-header">
              <div class="column-title">
                ${col.title}
                <span class="column-count">${tasks.length}</span>
              </div>
              <button class="column-add" onclick="openTaskModal('${col.id}')">+</button>
            </div>
            <div class="column-cards" ondragover="handleDragOver(event)" ondrop="handleDrop(event, '${col.id}')">
              ${tasks.map(t => renderTaskCard(t)).join('')}
            </div>
          </div>
        `;
      }).join('');
    }
    
    function renderTaskCard(task) {
      return `
        <div class="task-card" draggable="true" data-id="${task.id}" 
             ondragstart="handleDragStart(event)" ondragend="handleDragEnd(event)">
          <div class="task-title">${escapeHtml(task.title)}</div>
          <div class="task-meta">
            <span class="task-tag tag-${task.type}">${task.type}</span>
            ${task.projectId ? `<span>${getProjectName(task.projectId)}</span>` : ''}
          </div>
        </div>
      `;
    }
    
    function renderApprovals() {
      const list = document.getElementById('approvalsList');
      const badge = document.getElementById('approvalBadge');
      
      badge.style.display = state.approvals.length > 0 ? 'block' : 'none';
      badge.textContent = state.approvals.length;
      
      if (state.approvals.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><div class="empty-state-text">All clear!</div><div class="empty-state-sub">No pending approvals</div></div>';
        return;
      }
      
      list.innerHTML = state.approvals.map(a => `
        <div class="approval-card ${a.urgent ? 'urgent' : ''}">
          <div class="approval-header">
            <div class="approval-title">${escapeHtml(a.title)}</div>
            ${a.urgent ? '<span class="approval-badge">Urgent</span>' : ''}
          </div>
          <div class="approval-desc">${escapeHtml(a.description || 'Awaiting your decision')}</div>
          <div class="approval-meta">Requested ${timeAgo(a.createdAt)}</div>
          <div class="approval-actions">
            <button class="btn btn-success" onclick="handleApproval('${a.id}', true)">‚úì Approve</button>
            <button class="btn btn-danger" onclick="handleApproval('${a.id}', false)">‚úó Reject</button>
          </div>
        </div>
      `).join('');
    }
    
    function renderIdeas() {
      const grid = document.getElementById('ideasGrid');
      if (state.ideas.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí°</div><div class="empty-state-text">No ideas yet</div><div class="empty-state-sub">Capture ideas as they come</div></div>';
        return;
      }
      
      const potentialColors = { high: 'success', medium: 'warning', low: 'purple' };
      grid.innerHTML = state.ideas.map(idea => `
        <div class="project-card">
          <div class="project-header">
            <div class="project-icon">üí°</div>
            <span class="project-status ${idea.potential === 'high' ? 'active' : idea.potential === 'medium' ? 'planning' : 'idea'}">${idea.potential} potential</span>
          </div>
          <div class="project-name">${escapeHtml(idea.title)}</div>
          <div class="project-desc">${escapeHtml(idea.description || 'No notes')}</div>
          <div class="project-meta">
            <span class="project-meta-item">üìÖ ${timeAgo(idea.createdAt)}</span>
            <button class="btn btn-sm btn-secondary" onclick="convertIdeaToProject('${idea.id}')" style="margin-left: auto;">‚Üí Project</button>
          </div>
        </div>
      `).join('');
    }
    
    // Status is now fetched from status.json - see updateStatusUI()
    
    function updateProjectSelects() {
      const options = '<option value="">No Project</option>' + 
        state.projects.map(p => `<option value="${p.id}">${escapeHtml(p.name)}</option>`).join('');
      
      const taskProject = document.getElementById('taskProject');
      if (taskProject) taskProject.innerHTML = options;
      
      const filterOptions = '<option value="all">All Projects</option>' +
        state.projects.map(p => `<option value="${p.id}">${escapeHtml(p.name)}</option>`).join('');
      const filter = document.getElementById('taskProjectFilter');
      if (filter) filter.innerHTML = filterOptions;
    }
    
    // Drag & Drop
    let draggedId = null;
    
    function handleDragStart(e) {
      draggedId = e.target.dataset.id;
      e.target.classList.add('dragging');
    }
    
    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedId = null;
    }
    
    function handleDragOver(e) {
      e.preventDefault();
    }
    
    function handleDrop(e, columnId) {
      e.preventDefault();
      if (!draggedId) return;
      
      let task = null;
      let fromColumn = null;
      
      for (const col in state.tasks) {
        const idx = state.tasks[col].findIndex(t => t.id === draggedId);
        if (idx !== -1) {
          task = state.tasks[col].splice(idx, 1)[0];
          fromColumn = col;
          break;
        }
      }
      
      if (task) {
        state.tasks[columnId].push(task);
        if (columnId === 'done' && fromColumn !== 'done') {
          task.completedAt = new Date().toISOString();
          addActivity('‚úÖ', `Completed: ${task.title}`);
        } else if (columnId === 'in-progress' && fromColumn !== 'in-progress') {
          addActivity('üéØ', `Started: ${task.title}`);
        }
        render();
      }
    }
    
    // Modal Handling
    let modalTargetColumn = 'backlog';
    
    function openTaskModal(column = 'backlog') {
      modalTargetColumn = column;
      document.getElementById('taskModal').classList.add('active');
      document.getElementById('taskTitle').focus();
    }
    
    function openProjectModal() {
      document.getElementById('projectModal').classList.add('active');
      document.getElementById('projectName').focus();
    }
    
    function openIdeaModal() {
      document.getElementById('ideaModal').classList.add('active');
      document.getElementById('ideaTitle').focus();
    }
    
    function closeModal(id, e) {
      if (e && e.target !== e.currentTarget) return;
      document.getElementById(id).classList.remove('active');
    }
    
    // CRUD
    function createTask(e) {
      e.preventDefault();
      const task = {
        id: generateId(),
        title: document.getElementById('taskTitle').value.trim(),
        description: document.getElementById('taskDesc').value.trim(),
        projectId: document.getElementById('taskProject').value || null,
        type: document.getElementById('taskType').value,
        priority: document.getElementById('taskPriority').value,
        createdAt: new Date().toISOString()
      };
      
      const needsApproval = document.getElementById('taskApproval').value === 'yes';
      
      if (needsApproval) {
        state.approvals.push({
          id: generateId(),
          title: task.title,
          description: `New ${task.type}: ${task.description || task.title}`,
          urgent: task.priority === 'high',
          task,
          targetColumn: modalTargetColumn,
          createdAt: new Date().toISOString()
        });
        addActivity('üîî', `Approval requested: ${task.title}`);
      } else {
        state.tasks[modalTargetColumn].push(task);
        addActivity('üìù', `Created task: ${task.title}`);
      }
      
      closeModal('taskModal');
      e.target.reset();
      render();
    }
    
    function createProject(e) {
      e.preventDefault();
      const project = {
        id: generateId(),
        name: document.getElementById('projectName').value.trim(),
        description: document.getElementById('projectDesc').value.trim(),
        icon: document.getElementById('projectIcon').value.trim() || 'üìÅ',
        status: document.getElementById('projectStatus').value,
        revenue: document.getElementById('projectRevenue').value.trim(),
        createdAt: new Date().toISOString()
      };
      
      state.projects.push(project);
      addActivity('üìÅ', `Created project: ${project.name}`);
      closeModal('projectModal');
      e.target.reset();
      render();
    }
    
    function createIdea(e) {
      e.preventDefault();
      const idea = {
        id: generateId(),
        title: document.getElementById('ideaTitle').value.trim(),
        description: document.getElementById('ideaDesc').value.trim(),
        potential: document.getElementById('ideaPotential').value,
        createdAt: new Date().toISOString()
      };
      
      state.ideas.push(idea);
      addActivity('üí°', `New idea: ${idea.title}`);
      closeModal('ideaModal');
      e.target.reset();
      render();
    }
    
    function handleApproval(id, approved) {
      const idx = state.approvals.findIndex(a => a.id === id);
      if (idx === -1) return;
      
      const approval = state.approvals.splice(idx, 1)[0];
      
      if (approved && approval.task) {
        state.tasks[approval.targetColumn || 'backlog'].push(approval.task);
        addActivity('‚úÖ', `Approved: ${approval.title}`);
      } else {
        addActivity('‚ùå', `Rejected: ${approval.title}`);
      }
      
      render();
    }
    
    function convertIdeaToProject(ideaId) {
      const idx = state.ideas.findIndex(i => i.id === ideaId);
      if (idx === -1) return;
      
      const idea = state.ideas.splice(idx, 1)[0];
      const project = {
        id: generateId(),
        name: idea.title,
        description: idea.description,
        icon: 'üöÄ',
        status: 'planning',
        revenue: '',
        createdAt: new Date().toISOString()
      };
      
      state.projects.push(project);
      addActivity('üöÄ', `Promoted idea to project: ${project.name}`);
      render();
      navigate('projects');
    }
    
    // Helpers
    function getProjectName(id) {
      const p = state.projects.find(p => p.id === id);
      return p ? p.name : '';
    }
    
    function timeAgo(date) {
      const now = new Date();
      const then = new Date(date);
      const diff = Math.floor((now - then) / 1000);
      
      if (diff < 60) return 'just now';
      if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
      if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
      return `${Math.floor(diff / 86400)}d ago`;
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
      }
      if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
        e.preventDefault();
        openTaskModal();
      }
    });
    
    // Anton Status Sync
    const STATUS_URL = 'https://raw.githubusercontent.com/ant0n-pm/mission-control/main/status.json';
    let antonStatus = { state: 'offline', currentTask: null, tokens: null, updatedAt: null };
    
    async function fetchAntonStatus() {
      try {
        const res = await fetch(STATUS_URL + '?t=' + Date.now()); // cache bust
        if (!res.ok) throw new Error('Failed to fetch');
        antonStatus = await res.json();
        updateStatusUI();
      } catch (e) {
        console.warn('Status fetch failed:', e);
        antonStatus.state = 'offline';
        updateStatusUI();
      }
    }
    
    function updateStatusUI() {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');
      const taskEl = document.getElementById('statusTask');
      const taskText = document.getElementById('statusTaskText');
      const tokenBar = document.getElementById('tokenBarFill');
      const tokenContext = document.getElementById('tokenContext');
      const tokenMax = document.getElementById('tokenMax');
      const tokenIn = document.getElementById('tokenIn');
      const tokenOut = document.getElementById('tokenOut');
      const updated = document.getElementById('statusUpdated');
      
      // State
      const stateMap = {
        'working': { dot: 'working', text: 'Working' },
        'online': { dot: '', text: 'Online' },
        'idle': { dot: 'idle', text: 'Idle' },
        'offline': { dot: 'offline', text: 'Offline' }
      };
      const s = stateMap[antonStatus.state] || stateMap.offline;
      dot.className = 'status-dot ' + s.dot;
      text.textContent = s.text;
      
      // Current task
      if (antonStatus.currentTask && antonStatus.state === 'working') {
        taskEl.style.display = 'block';
        taskText.textContent = antonStatus.currentTask;
      } else {
        taskEl.style.display = 'none';
      }
      
      // Tokens
      if (antonStatus.tokens) {
        const t = antonStatus.tokens;
        const pct = Math.min(100, (t.context / t.contextMax) * 100);
        tokenBar.style.width = pct + '%';
        tokenContext.textContent = Math.round(t.context / 1000) + 'k';
        tokenMax.textContent = Math.round(t.contextMax / 1000) + 'k';
        tokenIn.textContent = t.in.toLocaleString();
        tokenOut.textContent = t.out.toLocaleString();
      }
      
      // Last sync
      if (antonStatus.updatedAt) {
        updated.textContent = 'Last sync: ' + timeAgo(antonStatus.updatedAt);
      }
    }
    
    // Poll status every 30 seconds
    fetchAntonStatus();
    setInterval(fetchAntonStatus, 30000);
    
    // Init
    render();
  </script>
</body>
</html>
